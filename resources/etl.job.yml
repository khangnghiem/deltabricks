# The main job for deltabricks.
resources:
  jobs:
    deltabricks_etl_job:
      name: deltabricks_etl_job
      trigger:
        periodic:
          interval: 1
          unit: DAYS
      #email_notifications:
      #  on_failure:
      #    - khangnghiem@gmail.com

      tasks:
        # bronze layer
        - task_key: extract_job_prospects
          environment_key: default
          spark_python_task:
            python_file: extract/transformations/extract_job_prospects.py
        # silver layer
        - task_key: clean_job_prospects
          environment_key: default
          depends_on:
            - task_key: extract_job_prospects
          notebook_task:
            notebook_path: load/transformations/clean_job_prospects.ipynb
        - task_key: top_job_popularity
          depends_on:
            - task_key: clean_job_prospects
          notebook_task:
            notebook_path: transform/transformations/top_recent_jobs.ipynb
        - task_key: jobs_by_area
          depends_on:
            - task_key: clean_job_prospects
          notebook_task:
            notebook_path: transform/transformations/jobs_by_area.ipynb
        - task_key: jobs_by_department
          depends_on:
            - task_key: clean_job_prospects
          notebook_task:
            notebook_path: transform/transformations/jobs_by_department.ipynb
        - task_key: jobs_by_views
          depends_on:
            - task_key: clean_job_prospects
          notebook_task:
            notebook_path: transform/transformations/jobs_by_views.ipynb
        - task_key: top_recent_jobs
          depends_on:
            - task_key: clean_job_prospects
          notebook_task:
            notebook_path: transform/transformations/top_recent_jobs.ipynb
        - task_key: top_salary_jobs
          depends_on:
            - task_key: clean_job_prospects
          notebook_task:
            notebook_path: transform/transformations/top_salary_jobs.ipynb

      environments:
        - environment_key: default
          # Full documentation of this spec can be found at:
          # https://docs.databricks.com/api/workspace/jobs/create#environments-spec
          spec:
            environment_version: "2"
            dependencies:
              - ../dist/*.whl

