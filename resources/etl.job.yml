# The main job for deltabricks.
resources:
  jobs:
    deltabricks_etl_job:
      name: deltabricks_etl_job
      trigger:
        periodic:
          interval: 1
          unit: DAYS
      #email_notifications:
      #  on_failure:
      #    - khangnghiem@gmail.com

      tasks:
        # bronze layer
        - task_key: extract_job_prospects
          environment_key: default
          spark_python_task:
            python_file: extract/transformations/extract_job_prospects.py
        # silver layer
        - task_key: clean_job_prospects
          environment_key: default
          depends_on:
            - task_key: extract_job_prospects
          notebook_task:
            notebook_path: load/transformations/clean_job_prospects.ipynb
        # feature engineering
        - task_key: job_description_features
          environment_key: default
          depends_on:
            - task_key: clean_job_prospects
          spark_python_task:
            python_file: feature_engineering/transformations/job_description_features.py
        # gold layer
        - task_key: top_job_popularity
          depends_on:
            - task_key: clean_job_prospects
          notebook_task:
            notebook_path: transform/transformations/top_recent_jobs.ipynb
        - task_key: jobs_by_area
          depends_on:
            - task_key: clean_job_prospects
          notebook_task:
            notebook_path: transform/transformations/jobs_by_area.ipynb
        # - task_key: predict_salary_task
        #   depends_on:
        #     - task_key: job_description_features
        #   environment_key: default
        #   python_wheel_task:
        #     package_name: deltabricks
        #     entry_point: main

      environments:
        - environment_key: default
          # Full documentation of this spec can be found at:
          # https://docs.databricks.com/api/workspace/jobs/create#environments-spec
          spec:
            environment_version: "2"
            dependencies:
              - ../dist/*.whl

